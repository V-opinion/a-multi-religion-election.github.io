(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12330],{491954:function(t,e,r){"use strict";r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return s.GEMINI_2_THEME_RELATIONSHIP},StoryItemType:function(){return _.StoryItemType},getSharingUrl:function(){return u.getSharingUrl},isPublicUser:function(){return u.isPublicUser},setItemFavoriteStatus:function(){return u.setItemFavoriteStatus}});var n=r(671123);r.o(n,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return n.GEMINI_2_THEME_RELATIONSHIP}}),r.o(n,"StoryItemType")&&r.d(e,{StoryItemType:function(){return n.StoryItemType}}),r.o(n,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return n.getSharingUrl}}),r.o(n,"isPublicUser")&&r.d(e,{isPublicUser:function(){return n.isPublicUser}}),r.o(n,"setItemFavoriteStatus")&&r.d(e,{setItemFavoriteStatus:function(){return n.setItemFavoriteStatus}});var o=r(121314);r.o(o,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return o.GEMINI_2_THEME_RELATIONSHIP}}),r.o(o,"StoryItemType")&&r.d(e,{StoryItemType:function(){return o.StoryItemType}}),r.o(o,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return o.getSharingUrl}}),r.o(o,"isPublicUser")&&r.d(e,{isPublicUser:function(){return o.isPublicUser}}),r.o(o,"setItemFavoriteStatus")&&r.d(e,{setItemFavoriteStatus:function(){return o.setItemFavoriteStatus}});var i=r(276031);r.o(i,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return i.GEMINI_2_THEME_RELATIONSHIP}}),r.o(i,"StoryItemType")&&r.d(e,{StoryItemType:function(){return i.StoryItemType}}),r.o(i,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return i.getSharingUrl}}),r.o(i,"isPublicUser")&&r.d(e,{isPublicUser:function(){return i.isPublicUser}}),r.o(i,"setItemFavoriteStatus")&&r.d(e,{setItemFavoriteStatus:function(){return i.setItemFavoriteStatus}});var a=r(442565);r.o(a,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return a.GEMINI_2_THEME_RELATIONSHIP}}),r.o(a,"StoryItemType")&&r.d(e,{StoryItemType:function(){return a.StoryItemType}}),r.o(a,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return a.getSharingUrl}}),r.o(a,"isPublicUser")&&r.d(e,{isPublicUser:function(){return a.isPublicUser}}),r.o(a,"setItemFavoriteStatus")&&r.d(e,{setItemFavoriteStatus:function(){return a.setItemFavoriteStatus}});var u=r(389085);r.o(u,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return u.GEMINI_2_THEME_RELATIONSHIP}}),r.o(u,"StoryItemType")&&r.d(e,{StoryItemType:function(){return u.StoryItemType}});var I=r(520662);r.o(I,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return I.GEMINI_2_THEME_RELATIONSHIP}}),r.o(I,"StoryItemType")&&r.d(e,{StoryItemType:function(){return I.StoryItemType}});var s=r(851002);r.o(s,"StoryItemType")&&r.d(e,{StoryItemType:function(){return s.StoryItemType}});var c=r(965005);r.o(c,"StoryItemType")&&r.d(e,{StoryItemType:function(){return c.StoryItemType}});var m=r(252826);r.o(m,"StoryItemType")&&r.d(e,{StoryItemType:function(){return m.StoryItemType}});var y=r(636187);r.o(y,"StoryItemType")&&r.d(e,{StoryItemType:function(){return y.StoryItemType}});var S=r(66673);r.o(S,"StoryItemType")&&r.d(e,{StoryItemType:function(){return S.StoryItemType}});var T=r(830680);r.o(T,"StoryItemType")&&r.d(e,{StoryItemType:function(){return T.StoryItemType}});var l=r(899345);r.o(l,"StoryItemType")&&r.d(e,{StoryItemType:function(){return l.StoryItemType}});var E=r(402939);r.o(E,"StoryItemType")&&r.d(e,{StoryItemType:function(){return E.StoryItemType}});var d=r(120662);r.o(d,"StoryItemType")&&r.d(e,{StoryItemType:function(){return d.StoryItemType}});var p=r(138024);r.o(p,"StoryItemType")&&r.d(e,{StoryItemType:function(){return p.StoryItemType}});var f=r(398331);r.o(f,"StoryItemType")&&r.d(e,{StoryItemType:function(){return f.StoryItemType}});var _=r(207415)},866409:function(){},586181:function(t,e,r){"use strict";r.d(e,{Z:function(){return n.Zl}});var n=r(500052)},515389:function(){},461284:function(){},485643:function(t,e,r){"use strict";r.d(e,{u:function(){return n.uX}});var n=r(996859)},389085:function(t,e,r){"use strict";r.d(e,{getSharingUrl:function(){return I.Z},isPublicUser:function(){return u.u},setItemFavoriteStatus:function(){return n.LZ}});var n=r(476250),o=r(461284);r.o(o,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return o.GEMINI_2_THEME_RELATIONSHIP}}),r.o(o,"StoryItemType")&&r.d(e,{StoryItemType:function(){return o.StoryItemType}}),r.o(o,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return o.getSharingUrl}}),r.o(o,"isPublicUser")&&r.d(e,{isPublicUser:function(){return o.isPublicUser}});var i=r(515389);r.o(i,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return i.GEMINI_2_THEME_RELATIONSHIP}}),r.o(i,"StoryItemType")&&r.d(e,{StoryItemType:function(){return i.StoryItemType}}),r.o(i,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return i.getSharingUrl}}),r.o(i,"isPublicUser")&&r.d(e,{isPublicUser:function(){return i.isPublicUser}});var a=r(866409);r.o(a,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return a.GEMINI_2_THEME_RELATIONSHIP}}),r.o(a,"StoryItemType")&&r.d(e,{StoryItemType:function(){return a.StoryItemType}}),r.o(a,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return a.getSharingUrl}}),r.o(a,"isPublicUser")&&r.d(e,{isPublicUser:function(){return a.isPublicUser}});var u=r(485643),I=r(586181)},671123:function(){},121314:function(){},276031:function(t,e,r){"use strict";var n=r(469424);r.o(n,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return n.GEMINI_2_THEME_RELATIONSHIP}}),r.o(n,"StoryItemType")&&r.d(e,{StoryItemType:function(){return n.StoryItemType}}),r.o(n,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return n.getSharingUrl}}),r.o(n,"isPublicUser")&&r.d(e,{isPublicUser:function(){return n.isPublicUser}}),r.o(n,"setItemFavoriteStatus")&&r.d(e,{setItemFavoriteStatus:function(){return n.setItemFavoriteStatus}});var o=r(552391);r.o(o,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return o.GEMINI_2_THEME_RELATIONSHIP}}),r.o(o,"StoryItemType")&&r.d(e,{StoryItemType:function(){return o.StoryItemType}}),r.o(o,"getSharingUrl")&&r.d(e,{getSharingUrl:function(){return o.getSharingUrl}}),r.o(o,"isPublicUser")&&r.d(e,{isPublicUser:function(){return o.isPublicUser}}),r.o(o,"setItemFavoriteStatus")&&r.d(e,{setItemFavoriteStatus:function(){return o.setItemFavoriteStatus}})},469424:function(){},552391:function(){},442565:function(){},520662:function(){},75906:function(){},851002:function(t,e,r){"use strict";r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return o.t}});var n=r(75906);r.o(n,"GEMINI_2_THEME_RELATIONSHIP")&&r.d(e,{GEMINI_2_THEME_RELATIONSHIP:function(){return n.GEMINI_2_THEME_RELATIONSHIP}}),r.o(n,"StoryItemType")&&r.d(e,{StoryItemType:function(){return n.StoryItemType}});var o=r(273670)},273670:function(t,e,r){"use strict";r.d(e,{t:function(){return n.t4}});var n=r(166236)},965005:function(){},252826:function(){},398331:function(){},66673:function(){},636187:function(){},830680:function(){},207415:function(t,e,r){"use strict";r.d(e,{StoryItemType:function(){return n.o}});var n=r(887960)},899345:function(){},402939:function(){},138024:function(){},120662:function(){},312330:function(t,e,r){"use strict";r.d(e,{gi:function(){return createStoryMapItem},wz:function(){return deleteItem},Vx:function(){return favoriteItem},j5:function(){return getReportAbuseLink},Az:function(){return incrementViewCount},mA:function(){return unfavoriteItem}});var n=r(552322);r(202784);var o=r(342670),i=r(348206),a=r(491954),u=r(139173),I=r(300993),s=r(606930);let findNetworkRequests=t=>window.performance.getEntriesByType("resource").filter(e=>"string"==typeof t?e.name===t:t.test(e.name));var c=r(100132),m=r(274465);let generateThemeDraftData=t=>{let{baseThemeId:e}=t,{defaultBaseVariables:r}=(0,m.w8)(e),n={...r};return delete n.colorRamps,{baseThemeId:e,variables:n}},favoriteItem=async t=>{try{await (0,a.setItemFavoriteStatus)({isFavorite:!0,itemId:t.id,authManager:t.authManager,owner:t.owner}),t.toast.add({type:"success",title:(0,n.jsx)(o.Z,{id:"itemUtils.addFavorite.success"})})}catch(e){throw t.toast.add({type:"error",title:(0,n.jsx)(o.Z,{id:"builder.common.sorry"}),details:(0,n.jsx)(o.Z,{id:"itemUtils.addFavorite.error"})}),Error(e)}},unfavoriteItem=async t=>{try{await (0,a.setItemFavoriteStatus)({isFavorite:!1,itemId:t.id,authManager:t.authManager,owner:t.owner}),t.toast.add({type:"success",title:(0,n.jsx)(o.Z,{id:"itemUtils.removeFavorite.success"})})}catch(e){throw t.toast.add({type:"error",title:(0,n.jsx)(o.Z,{id:"builder.common.sorry"}),details:(0,n.jsx)(o.Z,{id:"itemUtils.removeFavorite.error"})}),Error(e)}},deleteItem=async t=>{let e={[a.StoryItemType.Story]:(0,n.jsx)(o.Z,{id:"itemUtils.deleteStorySuccess"}),[a.StoryItemType.Frame]:(0,n.jsx)(o.Z,{id:"itemUtils.deleteFrameSuccess"}),[a.StoryItemType.Briefing]:(0,n.jsx)(o.Z,{id:"itemUtils.deleteBriefingSuccess"}),[a.StoryItemType.Collection]:(0,n.jsx)(o.Z,{id:"itemUtils.deleteCollectionSuccess"}),[a.StoryItemType.Theme]:(0,n.jsx)(o.Z,{id:"itemUtils.deleteThemeSuccess"})}[t.type],r={[a.StoryItemType.Story]:(0,n.jsx)(o.Z,{id:"itemUtils.errorDeletingStory"}),[a.StoryItemType.Frame]:(0,n.jsx)(o.Z,{id:"itemUtils.errorDeletingFrame"}),[a.StoryItemType.Briefing]:(0,n.jsx)(o.Z,{id:"itemUtils.errorDeletingBriefing"}),[a.StoryItemType.Collection]:(0,n.jsx)(o.Z,{id:"itemUtils.errorDeletingCollection"}),[a.StoryItemType.Theme]:(0,n.jsx)(o.Z,{id:"itemUtils.errorDeletingTheme"})}[t.type];try{await (0,i.cl)({authentication:t.authManager,id:t.id}),t.toast.add({type:"success",title:e})}catch(e){throw t.toast.add({type:"error",title:(0,n.jsx)(o.Z,{id:"builder.common.sorry"}),details:r}),Error(e)}},trackCreatingNewItem=t=>{switch(t.itemType){case a.StoryItemType.Story:{let e={sidecar:u.Z.Name.QuickStartTemplate_Sidecar,"guided-tour":u.Z.Name.QuickStartTemplate_GuidedTour,explorer:u.Z.Name.QuickStartTemplate_Explorer},r=t.templateForStory?e[t.templateForStory]:u.Z.Name.QuickStartTemplate_Default;r&&u.Z.trackEvent(u.Z.Category.Story,u.Z.Action.Story_CreateNewStory,r),t.hasThemeForStory&&u.Z.trackEvent(u.Z.Category.Story,u.Z.Action.Story_CreateNewStoryWithTheme);break}case a.StoryItemType.Collection:u.Z.trackEvent(u.Z.Category.Collection,u.Z.Action.Collection_CreateCollection);break;case a.StoryItemType.Theme:u.Z.trackEvent(u.Z.Category.Theme,u.Z.Action.Theme_CreateNewTheme)}},createStoryMapItem=async t=>{let e=await (0,a.isPublicUser)(t.authManager),r=await (0,c.mI)(t.config.BASE_URL),n=await t.authManager.getUser(),o=await (0,i.fC)({authentication:t.authManager,params:{thumbnail:r},item:(0,c.rV)(t.itemType,t.config,e,n.orgId)}),s=(()=>{switch(t.itemType){case a.StoryItemType.Story:return(0,c.U_)({firstName:n.firstName,lastName:n.lastName,title:t.title,theme:t.theme,baseThemeId:t.baseThemeId,webmap:t.webmap,webscene:t.webscene,template:t.template,shouldIncludeAuthorCard:t.featureDecisions.canUseAuthorCard,coverType:t.config.INCLUDED_STORY_COVERS[0]});case a.StoryItemType.Briefing:return(0,c.zb)({firstName:n.firstName,lastName:n.lastName,title:t.title,theme:t.theme,baseThemeId:t.baseThemeId,coverType:t.config.INCLUDED_STORY_COVERS[0]});case a.StoryItemType.Frame:return(0,c.Fn)();case a.StoryItemType.Collection:return(0,c.$U)({firstName:n.firstName,lastName:n.lastName,title:t.title,theme:t.theme,baseThemeId:t.baseThemeId});case a.StoryItemType.Theme:return generateThemeDraftData({baseThemeId:t.baseThemeId});default:return{}}})();return t.itemType===a.StoryItemType.Story&&t.theme&&(await (0,i.bV)({originItemId:t.theme,destinationItemId:o.id,relationshipType:a.GEMINI_2_THEME_RELATIONSHIP,authentication:t.authManager}),u.Z.trackEvent(u.Z.Category.Theme,u.Z.Action.Theme_AddRelationshipTheme2Story)),await (0,i.zJ)({authentication:t.authManager,id:o.id,name:"draft.json",resource:(0,I.ds)(s),owner:t.authManager.username,private:!0}),t.itemType===a.StoryItemType.Story&&trackCreatingNewItem({itemType:t.itemType,templateForStory:t.template,hasThemeForStory:!!t.theme}),o},getReportAbuseLink=t=>{let{storyUrl:e,getUrlFromRouteDef:r}=t,n=(0,s.w3)(e||window.location.href,["play","speed","cover","header"]);return r({route:"report-abuse",storyUrl:n})},incrementViewCount=t=>{let{itemId:e,portalHost:r,authManager:n,customTracker:o}=t;try{let t=findNetworkRequests(RegExp(`sharing/rest/content/items/${e}/data`)),u=window.performance.now(),I=t.reduce((t,e)=>{let r=u-e.startTime;return Math.min(r,t)},1/0);if(0===t.length||isFinite(I)&&I>9999){let trackItemView=()=>{(0,i.m_)(e,{authentication:n,portal:(0,a.getSharingUrl)(r,n)}),null==o||o()};"requestIdleCallback"in window?window.requestIdleCallback(trackItemView,{timeout:3e3}):setTimeout(trackItemView,3e3)}}catch{}}}}]);